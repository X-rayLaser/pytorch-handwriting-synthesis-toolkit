!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(self,(function(){return(()=>{"use strict";var e,t,r={1953:(e,t,r)=>{r(8594),r(5666);var n=r(8856);function a(e,t,r,n,a,o,s){try{var i=e[o](s),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,a)}function o(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var s=e.apply(t,r);function i(e){a(s,n,o,i,u,"next",e)}function u(e){a(s,n,o,i,u,"throw",e)}i(void 0)}))}}function s(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c=r(8736),l=self.fetch;self.fetch=function(){if("localhost"===location.hostname)return l.apply(this,arguments);var e=arguments[0];return e.endsWith("ort-wasm.wasm")&&(arguments[0]="https://x-raylaser.github.io/pytorch-handwriting-synthesis-toolkit/ort-wasm.wasm"),l.apply(this,arguments)};var f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.charset=" !\"#%'()+,-./0123456789:;?ABCDEFGHIJKLMNOPQRSTUVWXYZ[abcdefghijklmnopqrstuvwxyz",this.charToCode=new Map,this.codeToChar=new Map;for(var t=this.charset,r=0;r<t.length;r++){var n=t[r];this.charToCode.set(n,r+1),this.codeToChar.set(r+1,n)}}var t,r;return t=e,(r=[{key:"tokenize",value:function(e){for(var t=[],r=this.charToCode,n=0;n<e.length;n++){var a=e[n];r.has(a)?t.push(r.get(a)):t.push(0)}return t}},{key:"detokenize",value:function(e){for(var t="",r=0;r<e.length;r++){var n=e[r];t+=this.codeToChar.get(n)}return t}},{key:"charsetSize",value:function(){return this.charset.length+1}}])&&u(t.prototype,r),e}();function h(e,t){for(var r=[],n=0;n<t;n++)r[n]=0;return r[e]=1,r}function p(e){for(var t=new f,r=t.charsetSize(),n=t.tokenize(e),a=[],o=0;o<n.length;o++){var i=h(n[o],r);a.push.apply(a,s(i))}return new c.Tensor("float32",new Float32Array(a),[1,e.length,r])}function d(){return(d=o(regeneratorRuntime.mark((function e(t,r,n,a,o){var s,i,u,l,f,h,d,v,m,x,k,A,S,j,M,F,O,C,P,E,R,_,z,I;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.InferenceSession.create("./synthesis_network_52.onnx");case 2:s=e.sent,i={mu:[8.217162132263184,.1212363988161087,0],sd:[42.34926223754883,37.07347869873047,1]},(u=new Float32Array(1))[0]=a,l=new c.Tensor("float32",u,[1]),f=p(r+n),h=w(t),d=[{x:0,y:0,eos:0}].concat(y(h,i.mu,i.sd)),v=d.length,m=T(f,l),x=0;case 13:if(!(x<v-1)){e.next=32;break}return k=d[x],A=new c.Tensor("float32",new Float32Array([k.x,k.y,k.eos]),[1,1,3]),m.x=A,e.next=19,s.run(m);case 19:S=e.sent,j=new c.Tensor("float32",S.w.data,[1,1,80]),M=new c.Tensor("float32",S.k.data,[1,10]),F=new c.Tensor("float32",S.h1.data,[1,400]),O=new c.Tensor("float32",S.c1.data,[1,400]),C=new c.Tensor("float32",S.h2.data,[1,400]),P=new c.Tensor("float32",S.c2.data,[1,400]),E=new c.Tensor("float32",S.h3.data,[1,400]),R=new c.Tensor("float32",S.c3.data,[1,400]),m={c:f,"w.1":j,"k.1":M,"h1.1":F,"c1.1":O,"h2.1":C,"c2.1":P,"h3.1":E,"c3.1":R,bias:l};case 29:x++,e.next=13;break;case 32:return _=d[v-1],z=new c.Tensor("float32",new Float32Array([_.x,_.y,_.eos]),[1,1,3]),m.x=z,I=b(n),e.abrupt("return",g(m,i,l,o,1,I));case 38:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){var t=[],r=e.slice(1),n=e[0];return r.forEach((function(e){t.push({x:e.x-n.x,y:e.y-n.y,eos:e.eos}),n=e})),t}function y(e,t,r){return e.map((function(e){return{x:(e.x-t[0])/r[0],y:(e.y-t[1])/r[1],eos:Number(e.eos)}}))}function v(){return(v=o(regeneratorRuntime.mark((function e(t,r,n){var a,o,s,i,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={mu:[8.217162132263184,.1212363988161087,0],sd:[42.34926223754883,37.07347869873047,1]},o=b(t),s=p(t),(i=new Float32Array(1))[0]=r,u=new c.Tensor("float32",i,[1]),l=T(s,u),e.abrupt("return",g(l,a,u,n,1,o));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,t,r,n){return m.apply(this,arguments)}function m(){return(m=o(regeneratorRuntime.mark((function e(t,r,n,a){var o,s,i,u,l,f,h,p,d,w,y,v,g,m,b,T,A,S,j,M,F,O,C,P,E,R,_,z,I,$,N,B=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=B.length>4&&void 0!==B[4]?B[4]:1,s=B.length>5&&void 0!==B[5]?B[5]:1e3,e.next=4,c.InferenceSession.create("./synthesis_network_52.onnx");case 4:i=e.sent,u=0,l=0,f=[],h=t,p=t.c,d=0;case 11:if(!(d<s)){e.next=44;break}return e.next=14,i.run(h);case 14:if(w=e.sent,y=w.pi.data,v=w.mu.data,g=w.sd.data,m=w.eos.data,b=new c.Tensor("float32",w.w.data,[1,1,80]),T=new c.Tensor("float32",w.k.data,[1,10]),A=new c.Tensor("float32",w.h1.data,[1,400]),S=new c.Tensor("float32",w.c1.data,[1,400]),j=new c.Tensor("float32",w.h2.data,[1,400]),M=new c.Tensor("float32",w.c2.data,[1,400]),F=new c.Tensor("float32",w.h3.data,[1,400]),O=new c.Tensor("float32",w.c3.data,[1,400]),C=x(y,v,g,w.ro.data,m),P=C[0]*r.sd[0]+r.mu[0],E=C[1]*r.sd[1]+r.mu[1],u+=P,l+=E,!((R=p.dims[1])>=6&&k(w.phi.data,R,C[2]))){e.next=36;break}return C[2]=1,e.abrupt("break",44);case 36:f.push({x:Math.round(u),y:Math.round(l),eos:C[2]}),(_=d+1)%o==0&&f.length>0&&(z=void 0,I=Math.max(0,_-o),$=_,z=f.slice(I,$),a(Math.round(d/s*100),z)),N=new c.Tensor("float32",C,[1,1,3]),h={x:N,c:p,"w.1":b,"k.1":T,"h1.1":A,"c1.1":S,"h2.1":j,"c2.1":M,"h3.1":F,"c3.1":O,bias:n};case 41:d++,e.next=11;break;case 44:return e.abrupt("return",f);case 45:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:35;return t*e.length}function x(e,t,r,a,o){var s=A(0,e),i=e.length,u=new Float32Array(3),c=function(e,t,r,a,o){var s=o*r*a,i=[[Math.pow(r,2),s],[s,Math.pow(a,2)]],u=[e,t],c=(0,n.Z)(u,i).sample();return{x:c[0],y:c[1]}}(t[s],t[i+s],r[s],r[i+s],a[s]);return u[0]=c.x,u[1]=c.y,o[0]>.5?u[2]=1:u[2]=0,u}function T(e,t){return{x:new c.Tensor("float32",new Float32Array(3),[1,1,3]),c:e,"w.1":new c.Tensor("float32",new Float32Array(80),[1,1,80]),"k.1":new c.Tensor("float32",new Float32Array(10),[1,10]),"h1.1":new c.Tensor("float32",new Float32Array(400),[1,400]),"c1.1":new c.Tensor("float32",new Float32Array(400),[1,400]),"h2.1":new c.Tensor("float32",new Float32Array(400),[1,400]),"c2.1":new c.Tensor("float32",new Float32Array(400),[1,400]),"h3.1":new c.Tensor("float32",new Float32Array(400),[1,400]),"c3.1":new c.Tensor("float32",new Float32Array(400),[1,400]),bias:t}}function k(e,t,r){var n;return e[t-1]>.8||(n=e).indexOf(Math.max.apply(Math,s(n)))==t-1&&r}function A(e,t){if(1===t.length)return e;if(Math.random()<t[e])return e;for(var r=0,n=e+1;n<t.length;n++)r+=t[n];for(n=e+1;n<t.length;n++)t[n]=t[n]/r;return A(e+1,t)}self.addEventListener("unhandledrejection",(function(e){throw e.reason})),onmessage=function(e){var t=e.data[0],r=e.data[1],n=e.data[2],a=e.data[3],o=function(e,t){self.postMessage({event:"progressChanged",value:e,results:t})};n.length>0&&a.length>0?function(e,t,r,n,a){return d.apply(this,arguments)}(n,a,t,r,o).then((function(e){self.postMessage({event:"resultsReady",results:e})})).catch((function(e){throw"Error when generating handwriting with priming: ".concat(e)})):function(e,t,r){return v.apply(this,arguments)}(t,r,o).then((function(e){self.postMessage({event:"resultsReady",results:e})})).catch((function(e){throw"Error when generating handwriting: ".concat(e)}))}}},n={};function a(e){var t=n[e];if(void 0!==t)return t.exports;var o=n[e]={id:e,loaded:!1,exports:{}};return r[e](o,o.exports,a),o.loaded=!0,o.exports}return a.m=r,a.x=()=>{var e=a.O(void 0,[51],(()=>a(1953)));return a.O(e)},e=[],a.O=(t,r,n,o)=>{if(!r){var s=1/0;for(l=0;l<e.length;l++){for(var[r,n,o]=e[l],i=!0,u=0;u<r.length;u++)(!1&o||s>=o)&&Object.keys(a.O).every((e=>a.O[e](r[u])))?r.splice(u--,1):(i=!1,o<s&&(s=o));if(i){e.splice(l--,1);var c=n();void 0!==c&&(t=c)}}return t}o=o||0;for(var l=e.length;l>0&&e[l-1][2]>o;l--)e[l]=e[l-1];e[l]=[r,n,o]},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,r)=>(a.f[r](e,t),t)),[])),a.u=e=>e+".main.js",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={953:1};a.f.i=(t,r)=>{e[t]||importScripts(a.p+a.u(t))};var t=self.webpackChunkhandwriting_demo=self.webpackChunkhandwriting_demo||[],r=t.push.bind(t);t.push=t=>{var[n,o,s]=t;for(var i in o)a.o(o,i)&&(a.m[i]=o[i]);for(s&&s(a);n.length;)e[n.pop()]=1;r(t)}})(),t=a.x,a.x=()=>a.e(51).then(t),a.x()})()}));